{% extends 'OpensoftCodeConversationBundle::layout.html.twig' %}

{% block page_title %}Show commit {{ commit.sha1|truncate(6) }}{% endblock %}

{% block content %}

    {% include 'OpensoftCodeConversationBundle::commit.html.twig' with {'commit': commit, 'project': project} %}

    {% if commit.fileDiffs %}

        <p>Showing {{ commit.fileDiffs|length|default(0) }} files changed</p>
    
        {% include 'OpensoftCodeConversationBundle::diffs-table.html.twig' with {'diffs': commit.fileDiffs} %}

        <div>
            {% include 'OpensoftCodeConversationBundle::diffs-full.html.twig' with {'diffs': commit.fileDiffs} %}
        </div>
    {% endif %}


    {% if comments|length > 0 %}
        <h3>Comments?</h3>
        {% for comment in comments %}

            <table>
                <thead>
                    <tr style="background-color: #F5F5F5;">
                        <th>
                            {% include 'OpensoftCodeConversationBundle::useravatar.html.twig' with {'user': comment.author} %}
                            <span class="pull-right">{{ comment.createdAt|date("F j, Y") }}</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ comment.content | markdown}}</td>
                    </tr>
                </tbody>
            </table>
        {% endfor %}
    {% endif %}

    <h4>Comment on this commit</h4>

    <form action="{{ path('opensoft_codeconversation_comment_postcommitcomment', {'slug': project.slug, 'sha1': commit.sha1 }) }}" {{ form_enctype(form) }} method="POST">
        <fieldset>
            {{ form_errors(form) }}

            <div class="clearfix">
                {{ form_label(form.content) }}
                <div class="input">
                    {{ form_widget(form.content, { 'attr': {'class': 'span13', 'rows': 5} }) }}
                    <span class="help-block">Comments are parsed with everyone's favorite <a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a> language.</span>
                </div>
            </div>

            <div class="actions">
                <input name="preview" class="btn" type="submit" value="Preview" />
                <input name="add-comment" class="btn primary" type="submit" value="Add comment" />
            </div>

            {{ form_rest(form) }}
        </fieldset>
    </form>
{% endblock %}